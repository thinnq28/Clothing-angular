<!-- Begin Page Content -->
<div class="container-fluid">
    <!-- Page Heading -->
    <h1 class="h3 mb-2 text-gray-800">Manage User</h1>

    <!-- DataTales Example -->
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Users</h6>
      </div>

      <div class="card-body">
        <div class="table-responsive">
          <div id="dataTable_wrapper"
              class="dataTables_wrapper dt-bootstrap4">
              <div class="input-group-append">
                <button class="btn btn-primary btn-circle" type="button" (click)="searchUsers()">
                    <i class="fas fa-search fa-sm"></i>
                </button>
                <button type="button" class="btn btn-primary btn-circle" (click)="openCreateUser()">
                  <i class="fa-solid fa-plus"></i>
              </button>
            </div>
            <div class="row">
              <div class="col-sm-12 col-md-4">
                <div id="dataTable_filter" class="dataTables_filter">
                  <label>Search:
                    <input type="search"
                      class="form-control form-control-sm"
                      placeholder="Phone number" [(ngModel)]="phoneNumber"
                      aria-controls="dataTable"/></label>
                </div>
              </div>

              <div class="col-sm-12 col-md-4">
                <div id="dataTable_filter" class="dataTables_filter">
                  <label>Search:
                    <input type="search"
                      class="form-control form-control-sm" [(ngModel)]="name"
                      placeholder="Full name"
                      aria-controls="dataTable"/></label>
                </div>
              </div>

              <div class="col-sm-12 col-md-4">
                <div id="dataTable_filter" class="dataTables_filter">
                  <label>Search:
                    <input type="search"
                      class="form-control form-control-sm" [(ngModel)]="email"
                      placeholder="Email"
                      aria-controls="dataTable"/></label>
                </div>
              </div>
            </div>
            <div class="row" style="margin-top: 10px;">

              <div class="col-sm-12 col-md-4">
                <div class="dataTables_length" id="dataTable_length">
                  <label>Show: <select name="dataTable_length"
                      aria-controls="dataTable" [(ngModel)]="itemsPerPage"
                      class="custom-select custom-select-sm form-control form-control-sm">
                      <option [value]="10">10</option>
                      <option [value]="25">25</option>
                      <option [value]="50">50</option>
                      <option [value]="100">100</option>
                    </select> entries</label>
                </div>
              </div>

              <div class="col-sm-12 col-md-4">
                <div class="dataTables_length" id="dataTable_length">
                  <label>Role: <select name="dataTable_length" aria-controls="dataTable"
                    [(ngModel)]="roleId"
                      class="custom-select custom-select-sm form-control form-control-sm">
                      <option [value]="0">Tất cả</option> 
                      <option [value]="1">ADMIN</option>
                      <option [value]="2">USER</option>
                      <option [value]="3">GUEST</option>
                    </select></label>
                </div>
              </div>

              <div class="col-sm-12 col-md-4">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckChecked"
                      [(ngModel)]="isActive" checked>
                  <label class="form-check-label" for="flexSwitchCheckChecked"> Active</label>
              </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <table
                  class="table table-bordered dataTable"
                  id="dataTable"
                  width="100%"
                  cellspacing="0"
                  role="grid"
                  aria-describedby="dataTable_info"
                  style="width: 100%">
                  <thead>
                    <tr role="row">
                      <th
                        class="sorting sorting_asc"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-sort="ascending"
                        aria-label="Name: activate to sort column descending"
                        style="width: 64.75px">Full name</th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-label="Position: activate to sort column ascending"
                        style="width: 80.6094px">
                        Phone number
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-label="Office: activate to sort column ascending"
                        style="width: 67.8516px">
                        Email
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-label="Age: activate to sort column ascending"
                        style="width: 66.1094px">
                        Date of birth
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-label="Start date: activate to sort column ascending"
                        style="width: 67.8516px">
                        Address
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-label="Salary: activate to sort column ascending"
                        style="width: 30.1641px">
                        Active
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-label="Salary: activate to sort column ascending"
                        style="width: 30.1641px">
                        Role
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="dataTable"
                        rowspan="1"
                        colspan="1"
                        aria-label="Salary: activate to sort column ascending"
                        style="width: 30.1641px">
                        Delete
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="odd" *ngFor="let user of users">
                      <td class="sorting_1">{{ user.fullname }}</td>
                      <td>{{ user.phone_number }}</td>
                      <td>{{ user.email }}</td>
                      <td>{{ user.date_of_birth }}</td>
                      <td>{{ user.address }}</td>
                      <td>{{ user.is_active }}</td>
                      <td>{{ user.roles[0].name }}</td>
                      <td *ngIf="user.is_active">
                        <button class="btn" type="button" (click)="openModal(user.id)">
                          <i class="fa-solid fa-trash"></i></button>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <!--Pagetable-->
                <div class="d-flex justify-content-center">
                  <nav aria-label="Page navigation">
                    <ul class="pagination">
                      <li class="page-item" *ngIf="currentPage > 0">
                        <a class="page-link" (click)="onPageChange(0)">First</a>
                      </li>
                      <li class="page-item" *ngIf="currentPage > 0">
                        <a class="page-link" (click)="onPageChange(currentPage - 1)">
                          <i class="fa fa-chevron-left"></i>
                        </a>
                      </li>
                      <ng-container *ngFor="let page of visiblePages">
                          <li class="page-item" [ngClass]="{'active': page === currentPage + 1}">
                            <a class="page-link" (click)="onPageChange(page - 1)">{{ page }}</a>
                          </li>
                        </ng-container>
                      <li class="page-item" *ngIf="currentPage < totalPages - 1">
                        <a class="page-link" (click)="onPageChange(currentPage + 1)">
                          <i class="fa fa-chevron-right"></i>
                        </a>
                      </li>
                      <li class="page-item" *ngIf="currentPage < totalPages - 1">
                        <a class="page-link" (click)="onPageChange(totalPages - 1)">Last</a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- The Modal -->
  <div class="modal" tabindex="-1" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Notification</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <p>Do you want to delete this user?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="closeModal()">Close</button>
          <button type="button" class="btn btn-danger" (click)="deleteUser()">Delete</button>
        </div>
      </div>
    </div>
  </div>

<div class="modal" id="modalCreateUser" >
    <div class="modal-dialog">
      <div class="modal-content">
  
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Create User</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" (click)="closeCreateUser()"></button>
        </div>
  
        <!-- Modal body -->
        <div class="modal-body" *ngIf="isCreate">
          <div class="container mt-5">
            <form #registerForm="ngForm">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" class="form-control" 
                    [(ngModel)]="fullName"
                    name="fullName"
                    id="fullName" placeholder="Enter full name" required>
                </div>
                <div class="form-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input type="tel" class="form-control" id="phoneNumber" 
                    [(ngModel)]="phoneNumberRegister"
                    name="phoneNumberRegister"
                    placeholder="Enter phone number" required>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" 
                    [(ngModel)]="emailRegister"
                    name="emailRegister"
                    placeholder="Enter email" required>
                </div>
                <div class="form-group">
                    <label for="address">Address</label>
                    <input type="text" class="form-control" id="address"
                    [(ngModel)]="address"
                    name="address"
                     placeholder="Enter address" required>
                </div>
                <div class="form-group">
                    <label for="dateOfBirth">Date of Birth</label>
                    <input type="date" class="form-control" 
                    [(ngModel)]="dateOfBirth"
                    name="dateOfBirth"
                    id="dateOfBirth" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password"
                    [(ngModel)]="password"
                    name="password"
                     placeholder="Enter password" required>
                </div>
                <div class="form-group">
                  <label for="password">Retype password</label>
                  <input type="password" class="form-control" id="password"
                  [(ngModel)]="retypePassword"
                  name="retypePassword"
                   placeholder="Enter password" required>
              </div>
            </form>
        </div>
        </div>
  
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
           (click)="register()">Save</button>
        </div>
  
      </div>
    </div>
  </div>

  <div class="card flex justify-content-center">
    <p-toast />
  </div>